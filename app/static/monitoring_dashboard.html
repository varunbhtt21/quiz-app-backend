<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 System Monitoring Dashboard</title>
    
    <!-- Chart.js from CDN for beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Section */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .system-status {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 50px;
            margin-top: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-healthy { background: #10B981; }
        .status-warning { background: #F59E0B; }
        .status-critical { background: #EF4444; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .last-updated {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
        }

        .metric-icon {
            font-size: 1.5rem;
            filter: grayscale(0.3);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-unit {
            font-size: 1rem;
            color: #6B7280;
            margin-left: 5px;
        }

        .metric-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend-up { color: #EF4444; }
        .trend-down { color: #10B981; }
        .trend-stable { color: #6B7280; }

        /* Charts Section */
        .charts-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .charts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .charts-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
        }

        .time-selector {
            display: flex;
            gap: 10px;
        }

        .time-btn {
            padding: 8px 16px;
            border: 2px solid #E5E7EB;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .time-btn.active,
        .time-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #E5E7EB;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Capacity Analysis */
        .capacity-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .capacity-header {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            text-align: center;
        }

        .capacity-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .capacity-stat {
            text-align: center;
            padding: 20px;
            background: #F9FAFB;
            border-radius: 15px;
            border: 1px solid #E5E7EB;
        }

        .capacity-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .capacity-stat-label {
            color: #6B7280;
            font-size: 0.9rem;
        }

        .capacity-health-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 25px;
            margin-left: 20px;
            transition: all 0.3s ease;
        }

        .capacity-health-badge.excellent {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }

        .capacity-health-badge.good {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
        }

        .capacity-health-badge.warning {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
        }

        .capacity-health-badge.critical {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }

        .capacity-breakdown {
            background: linear-gradient(135deg, #F3F4F6, #E5E7EB);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .capacity-breakdown h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .capacity-info {
            display: grid;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            font-size: 0.95rem;
        }

        .info-label {
            font-weight: 600;
        }

        .info-value {
            font-weight: 700;
            color: #1F2937;
        }

        .recommendations {
            background: #F0F9FF;
            border: 1px solid #0EA5E9;
            border-radius: 15px;
            padding: 20px;
        }

        .recommendations h3 {
            color: #0EA5E9;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recommendation-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
            color: #374151;
        }

        .recommendation-item:last-child {
            border-bottom: none;
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.1rem;
            color: #6B7280;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #E5E7EB;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error States */
        .error {
            background: #FEF2F2;
            border: 1px solid #EF4444;
            border-radius: 15px;
            padding: 20px;
            color: #DC2626;
            text-align: center;
        }



        /* Metrics Information Section */
        .metrics-info-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-header {
            font-size: 2rem;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 15px;
            text-align: center;
        }

        .info-description {
            font-size: 1.1rem;
            color: #6B7280;
            text-align: center;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .metrics-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-info-card {
            background: linear-gradient(135deg, #F8FAFC, #F1F5F9);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #E2E8F0;
            transition: all 0.3s ease;
        }

        .metric-info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .metric-info-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-info-icon {
            font-size: 1.8rem;
            margin-right: 12px;
        }

        .metric-info-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1F2937;
            margin: 0;
        }

        .metric-info-content p {
            color: #374151;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .metric-ranges {
            margin: 15px 0;
        }

        .range-item {
            padding: 8px 12px;
            margin: 6px 0;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .range-item.good {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10B981;
        }

        .range-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #F59E0B;
        }

        .range-item.critical {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #EF4444;
        }

        .metric-impact {
            background: rgba(59, 130, 246, 0.05);
            border-left: 4px solid #3B82F6;
            padding: 12px 15px;
            border-radius: 8px;
            font-style: italic;
            color: #1E40AF;
        }

        .capacity-info-section {
            background: linear-gradient(135deg, #EEF2FF, #E0E7FF);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #C7D2FE;
        }

        .capacity-info-section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1E40AF;
            margin-bottom: 25px;
            text-align: center;
        }

        .capacity-guide {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .guide-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(199, 210, 254, 0.5);
        }

        .guide-item h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1E40AF;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .guide-item ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .guide-item li {
            padding: 6px 0;
            color: #374151;
            line-height: 1.5;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }

        .guide-item li:last-child {
            border-bottom: none;
        }

        .guide-item li strong {
            color: #1F2937;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .capacity-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metrics-info-section {
                padding: 20px;
            }
            
            .metrics-info-grid {
                grid-template-columns: 1fr;
            }
            
            .capacity-guide {
                grid-template-columns: 1fr;
            }
            
            .info-header {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>🚀 System Monitoring Dashboard</h1>
            <div class="system-status">
                <div id="status-indicator" class="status-indicator status-healthy"></div>
                <span id="system-status-text">System Healthy</span>
                <span id="health-score">• Score: 95/100</span>
            </div>
            <div class="last-updated">
                Last updated: <span id="last-updated">--</span>
            </div>
        </div>

        <!-- Real-time Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">CPU Usage</span>
                    <span class="metric-icon">🖥️</span>
                </div>
                <div class="metric-value" id="cpu-value">--<span class="metric-unit">%</span></div>
                <div class="metric-trend" id="cpu-trend">
                    <span>📈</span> <span>Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Memory Usage</span>
                    <span class="metric-icon">💾</span>
                </div>
                <div class="metric-value" id="memory-value">--<span class="metric-unit">%</span></div>
                <div class="metric-trend" id="memory-trend">
                    <span>📈</span> <span>Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Active Users</span>
                    <span class="metric-icon">👥</span>
                </div>
                <div class="metric-value" id="users-value">--<span class="metric-unit">users</span></div>
                <div class="metric-trend" id="users-trend">
                    <span>📈</span> <span>Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Response Time</span>
                    <span class="metric-icon">⚡</span>
                </div>
                <div class="metric-value" id="response-value">--<span class="metric-unit">ms</span></div>
                <div class="metric-trend" id="response-trend">
                    <span>📈</span> <span>Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">DB Connections</span>
                    <span class="metric-icon">🗄️</span>
                </div>
                <div class="metric-value" id="db-value">--<span class="metric-unit"></span></div>
                <div class="metric-trend" id="db-trend">
                    <span>📊</span> <span>Loading...</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Error Rate</span>
                    <span class="metric-icon">⚠️</span>
                </div>
                <div class="metric-value" id="error-value">--<span class="metric-unit">%</span></div>
                <div class="metric-trend" id="error-trend">
                    <span>📈</span> <span>Loading...</span>
                </div>
            </div>
        </div>

        <!-- Historical Charts -->
        <div class="charts-section">
            <div class="charts-header">
                <h2 class="charts-title">📊 Performance Trends</h2>
                <div class="time-selector">
                    <button class="time-btn" onclick="changeTimeframe(1)">1H</button>
                    <button class="time-btn active" onclick="changeTimeframe(4)">4H</button>
                    <button class="time-btn" onclick="changeTimeframe(12)">12H</button>
                    <button class="time-btn" onclick="changeTimeframe(24)">24H</button>
                </div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">System Resources</div>
                    <canvas id="systemChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">User Activity & Performance</div>
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Capacity Analysis -->
        <div class="capacity-section">
            <h2 class="capacity-header">🎯 Capacity Analysis</h2>
            <div class="capacity-health-badge" id="capacity-health-badge">
                <span id="capacity-health-text">Loading...</span>
            </div>
            
            <div class="capacity-stats">
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="current-users">--</div>
                    <div class="capacity-stat-label">Current Users</div>
                </div>
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="max-users">--</div>
                    <div class="capacity-stat-label">Estimated Max Users</div>
                </div>
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="peak-capacity">--</div>
                    <div class="capacity-stat-label">Peak Capacity</div>
                </div>
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="safe-capacity">--</div>
                    <div class="capacity-stat-label">Safe Concurrent</div>
                </div>
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="utilization">--%</div>
                    <div class="capacity-stat-label">Utilization</div>
                </div>
                <div class="capacity-stat">
                    <div class="capacity-stat-value" id="instance-type">--</div>
                    <div class="capacity-stat-label">Instance Type</div>
                </div>
            </div>

            <div class="capacity-breakdown">
                <h3>📊 Capacity Breakdown</h3>
                <div class="capacity-info">
                    <div class="info-item">
                        <span class="info-label">🟢 Safe Operation:</span>
                        <span class="info-value" id="safe-range">0-40 users</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">🟡 Caution Zone:</span>
                        <span class="info-value" id="caution-range">41-50 users</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">🔴 Critical Zone:</span>
                        <span class="info-value" id="critical-range">51+ users</span>
                    </div>
                </div>
            </div>

            <div class="recommendations" id="recommendations">
                <h3>💡 Scaling Recommendations</h3>
                <div id="recommendations-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading recommendations...
                    </div>
                </div>
            </div>
        </div>

        <!-- Metrics Information Section -->
        <div class="metrics-info-section">
            <h2 class="info-header">📚 Understanding Your Metrics</h2>
            <p class="info-description">Learn what each metric means and how to interpret the values for better system monitoring.</p>
            
            <div class="metrics-info-grid">
                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">🖥️</span>
                        <h3>CPU Usage</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Percentage of processing power being used by your application and system processes.</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-70%:</strong> Healthy range - system running smoothly</div>
                            <div class="range-item warning">🟡 <strong>70-85%:</strong> High load - monitor closely during peak hours</div>
                            <div class="range-item critical">🔴 <strong>85%+:</strong> Critical - may cause slow response times and timeouts</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> High CPU usage leads to slower response times, potential timeouts, and poor user experience.</p>
                    </div>
                </div>

                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">💾</span>
                        <h3>Memory Usage</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Percentage of RAM (Random Access Memory) being consumed by your application.</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-75%:</strong> Healthy range - sufficient memory available</div>
                            <div class="range-item warning">🟡 <strong>75-85%:</strong> High usage - consider memory optimization</div>
                            <div class="range-item critical">🔴 <strong>85%+:</strong> Critical - may cause app crashes and system slowdown</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> High memory usage can cause application crashes, slower database queries, and system instability.</p>
                    </div>
                </div>

                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">👥</span>
                        <h3>Active Users</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Number of users currently using the system (students taking quizzes, admins managing content).</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-40 users:</strong> Safe operation zone for t3.medium instance</div>
                            <div class="range-item warning">🟡 <strong>40-60 users:</strong> Approaching capacity - monitor system resources</div>
                            <div class="range-item critical">🔴 <strong>60+ users:</strong> Consider scaling up to handle the load</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> More concurrent users increase load on CPU, memory, and database connections.</p>
                    </div>
                </div>

                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">⚡</span>
                        <h3>Response Time</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Average time it takes for API requests to complete and return responses.</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-200ms:</strong> Excellent performance - users experience fast responses</div>
                            <div class="range-item warning">🟡 <strong>200-500ms:</strong> Acceptable but monitor for performance issues</div>
                            <div class="range-item critical">🔴 <strong>500ms+:</strong> Slow performance - investigate bottlenecks immediately</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> High response times lead to poor user experience, timeouts, and frustrated users.</p>
                    </div>
                </div>

                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">🗄️</span>
                        <h3>Database Connections</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Number of active database connections out of the total connection pool (50 total: 20 base + 30 overflow).</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-30 connections:</strong> Healthy database usage</div>
                            <div class="range-item warning">🟡 <strong>30-40 connections:</strong> High usage - monitor connection efficiency</div>
                            <div class="range-item critical">🔴 <strong>40+ connections:</strong> Bottleneck risk - optimize queries and connections</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> High connection usage causes database queries to wait, leading to slower responses.</p>
                    </div>
                </div>

                <div class="metric-info-card">
                    <div class="metric-info-header">
                        <span class="metric-info-icon">⚠️</span>
                        <h3>Error Rate</h3>
                    </div>
                    <div class="metric-info-content">
                        <p><strong>What it means:</strong> Percentage of requests that failed or returned errors.</p>
                        <div class="metric-ranges">
                            <div class="range-item good">🟢 <strong>0-1%:</strong> Excellent - system operating normally</div>
                            <div class="range-item warning">🟡 <strong>1-2%:</strong> Elevated errors - investigate potential issues</div>
                            <div class="range-item critical">🔴 <strong>2%+:</strong> High error rate - immediate attention required</div>
                        </div>
                        <p class="metric-impact"><strong>Impact:</strong> High error rates mean users can't submit quizzes, login failures, and system instability.</p>
                    </div>
                </div>
            </div>

            <div class="capacity-info-section">
                <h3>🎯 Capacity Planning Guide</h3>
                <div class="capacity-guide">
                    <div class="guide-item">
                        <h4>📊 Current Metrics</h4>
                        <ul>
                            <li><strong>Current Users:</strong> Active users right now</li>
                            <li><strong>Estimated Max Users:</strong> Maximum concurrent users your system can handle</li>
                            <li><strong>Peak Capacity:</strong> Burst capacity with 30% overhead</li>
                            <li><strong>Safe Concurrent:</strong> Recommended maximum for stable operation (80% of max)</li>
                        </ul>
                    </div>
                    <div class="guide-item">
                        <h4>🚀 EC2 Instance Recommendations</h4>
                        <ul>
                            <li><strong>t3.micro:</strong> 1GB RAM, ~10 concurrent users</li>
                            <li><strong>t3.small:</strong> 2GB RAM, ~25 concurrent users</li>
                            <li><strong>t3.medium:</strong> 4GB RAM, ~50 concurrent users (current)</li>
                            <li><strong>t3.large:</strong> 8GB RAM, ~100 concurrent users</li>
                            <li><strong>t3.xlarge:</strong> 16GB RAM, ~200 concurrent users</li>
                        </ul>
                    </div>
                    <div class="guide-item">
                        <h4>⚡ Performance Tips</h4>
                        <ul>
                            <li>Monitor during peak hours (exam times)</li>
                            <li>Scale up before reaching 80% capacity</li>
                            <li>Optimize database queries if connections are high</li>
                            <li>Consider caching for high memory usage</li>
                            <li>Set up alerts for critical thresholds</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTimeframe = 4;
        let systemChart, performanceChart;
        // No authentication required - monitoring is public

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            startAutoRefresh();
        });

        async function initializeDashboard() {
            try {
                showLoading();
                await loadDashboardData();
                initializeCharts();
                hideLoading();
            } catch (error) {
                console.error('Failed to initialize dashboard:', error);
                showError('Failed to load dashboard data. Please check your connection and try again.');
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/monitoring/dashboard-data', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                updateMetrics(data.current);
                updateCapacityAnalysis(data.capacity);
                updateCharts(data.historical);
                updateLastUpdated();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                throw error;
            }
        }

        function updateMetrics(current) {
            const metrics = current.metrics;
            const healthStatus = current.health_status;

            // Update metric values
            document.getElementById('cpu-value').innerHTML = `${metrics.cpu_percent}<span class="metric-unit">%</span>`;
            document.getElementById('memory-value').innerHTML = `${metrics.memory_percent}<span class="metric-unit">%</span>`;
            document.getElementById('users-value').innerHTML = `${metrics.active_users}<span class="metric-unit">users</span>`;
            document.getElementById('response-value').innerHTML = `${metrics.response_time_ms}<span class="metric-unit">ms</span>`;
            document.getElementById('db-value').innerHTML = `${metrics.db_connections}<span class="metric-unit"></span>`;
            document.getElementById('error-value').innerHTML = `${metrics.error_rate_percent}<span class="metric-unit">%</span>`;

            // Update system status
            updateSystemStatus(healthStatus);

            // Update trends (simplified for now)
            updateTrends(metrics);
        }

        function updateSystemStatus(healthStatus) {
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('system-status-text');
            const healthScore = document.getElementById('health-score');

            statusIndicator.className = `status-indicator status-${healthStatus.status}`;
            
            const statusTexts = {
                'healthy': 'System Healthy',
                'warning': 'System Warning',
                'critical': 'System Critical'
            };
            
            statusText.textContent = statusTexts[healthStatus.status] || 'System Unknown';
            healthScore.textContent = `• Score: ${healthStatus.score}/100`;
        }

        function updateTrends(metrics) {
            // Simple trend indicators (in a real app, you'd compare with previous values)
            const trends = [
                { id: 'cpu-trend', value: metrics.cpu_percent, threshold: 70 },
                { id: 'memory-trend', value: metrics.memory_percent, threshold: 75 },
                { id: 'users-trend', value: metrics.active_users, threshold: 80 },
                { id: 'response-trend', value: metrics.response_time_ms, threshold: 500 },
                { id: 'error-trend', value: metrics.error_rate_percent, threshold: 2 }
            ];

            trends.forEach(trend => {
                const element = document.getElementById(trend.id);
                const span = element.querySelector('span:last-child');
                
                if (trend.value > trend.threshold) {
                    element.className = 'metric-trend trend-up';
                    span.textContent = 'Above threshold';
                } else if (trend.value < trend.threshold * 0.5) {
                    element.className = 'metric-trend trend-down';
                    span.textContent = 'Optimal';
                } else {
                    element.className = 'metric-trend trend-stable';
                    span.textContent = 'Normal';
                }
            });

            // Special case for DB connections
            const dbTrend = document.getElementById('db-trend');
            const dbSpan = dbTrend.querySelector('span:last-child');
            dbTrend.className = 'metric-trend trend-stable';
            dbSpan.textContent = 'Pool healthy';
        }

        function updateCapacityAnalysis(capacity) {
            // Update capacity values
            document.getElementById('current-users').textContent = capacity.current_users;
            document.getElementById('max-users').textContent = capacity.estimated_max_users;
            document.getElementById('utilization').textContent = `${capacity.utilization_percent}%`;
            
            // Update new capacity fields
            if (capacity.predicted_peak_capacity) {
                document.getElementById('peak-capacity').textContent = capacity.predicted_peak_capacity;
            }
            if (capacity.safe_concurrent_users) {
                document.getElementById('safe-capacity').textContent = capacity.safe_concurrent_users;
            }
            if (capacity.instance_type) {
                document.getElementById('instance-type').textContent = capacity.instance_type;
            }

            // Update capacity health badge
            const healthBadge = document.getElementById('capacity-health-badge');
            const healthText = document.getElementById('capacity-health-text');
            
            if (capacity.capacity_health) {
                healthText.textContent = capacity.capacity_health;
                healthBadge.className = `capacity-health-badge ${capacity.capacity_health.toLowerCase()}`;
            }

            // Update capacity breakdown ranges
            const safeMax = Math.floor(capacity.safe_concurrent_users || capacity.estimated_max_users * 0.8);
            const cautionMax = Math.floor(capacity.estimated_max_users || 50);
            
            document.getElementById('safe-range').textContent = `0-${safeMax} users`;
            document.getElementById('caution-range').textContent = `${safeMax + 1}-${cautionMax} users`;
            document.getElementById('critical-range').textContent = `${cautionMax + 1}+ users`;

            // Update recommendations
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = '';
            
            capacity.recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-item';
                div.innerHTML = rec; // Use innerHTML to support emoji and formatting
                recommendationsList.appendChild(div);
            });
        }

        function initializeCharts() {
            // System Resources Chart
            const systemCtx = document.getElementById('systemChart').getContext('2d');
            systemChart = new Chart(systemCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'CPU %',
                            data: [],
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Memory %',
                            data: [],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });

            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Active Users',
                            data: [],
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Response Time (ms)',
                            data: [],
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Users'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Response Time (ms)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function updateCharts(historical) {
            if (!historical || !historical.timestamps || historical.timestamps.length === 0) {
                // Generate sample data if no historical data available
                console.log('No historical data available, using sample data for demonstration');
                const sampleData = generateSampleData(20); // 20 data points
                updateChartsWithData(sampleData);
                return;
            }
            
            // Format timestamps for display
            const labels = historical.timestamps.map(ts => {
                const date = new Date(ts);
                return date.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            });

            // Update system chart
            systemChart.data.labels = labels;
            systemChart.data.datasets[0].data = historical.cpu || [];
            systemChart.data.datasets[1].data = historical.memory || [];
            systemChart.update();

            // Update performance chart
            performanceChart.data.labels = labels;
            performanceChart.data.datasets[0].data = historical.users || [];
            performanceChart.data.datasets[1].data = historical.response_time || [];
            performanceChart.update();
        }

        function generateSampleData(points) {
            const now = new Date();
            const data = {
                timestamps: [],
                cpu: [],
                memory: [],
                users: [],
                response_time: []
            };

            for (let i = 0; i < points; i++) {
                // Generate timestamps going back in time
                const time = new Date(now.getTime() - (points - i) * 3 * 60000); // 3 minutes apart
                data.timestamps.push(time.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }));
                
                // Generate realistic sample data with some variation
                const baseTime = i / points;
                data.cpu.push(Math.max(0, Math.min(100, 30 + Math.sin(baseTime * Math.PI * 2) * 20 + Math.random() * 10)));
                data.memory.push(Math.max(0, Math.min(100, 45 + Math.sin(baseTime * Math.PI * 3) * 15 + Math.random() * 8)));
                data.users.push(Math.max(0, Math.floor(3 + Math.sin(baseTime * Math.PI * 4) * 2 + Math.random() * 3)));
                data.response_time.push(Math.max(50, 150 + Math.sin(baseTime * Math.PI * 2.5) * 50 + Math.random() * 30));
            }

            return data;
        }

        function updateChartsWithData(data) {
            // Update system chart
            systemChart.data.labels = data.timestamps;
            systemChart.data.datasets[0].data = data.cpu;
            systemChart.data.datasets[1].data = data.memory;
            systemChart.update();

            // Update performance chart
            performanceChart.data.labels = data.timestamps;
            performanceChart.data.datasets[0].data = data.users;
            performanceChart.data.datasets[1].data = data.response_time;
            performanceChart.update();
        }

        async function changeTimeframe(hours) {
            currentTimeframe = hours;
            
            // Update active button
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            try {
                const response = await fetch(`/api/monitoring/historical/${hours}`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateCharts(data);
                }
            } catch (error) {
                console.error('Error changing timeframe:', error);
            }
        }

        function startAutoRefresh() {
            // Refresh every 30 seconds
            setInterval(async () => {
                try {
                    await loadDashboardData();
                } catch (error) {
                    console.error('Auto-refresh failed:', error);
                }
            }, 30000);
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleTimeString();
        }

        function showLoading() {
            // Implementation for loading states
        }

        function hideLoading() {
            // Implementation for hiding loading states
        }

        function showError(message) {
            // Create error banner
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(errorDiv, container.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Public monitoring dashboard - no authentication required
    </script>
</body>
</html> 